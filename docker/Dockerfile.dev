FROM python:3.12-slim

ENV DEBIAN_FRONTEND=noninteractive \
    PYTHONDONTWRITEBYTECODE=1 \
    PYTHONUNBUFFERED=1

RUN apt-get update && apt-get install -y --no-install-recommends curl git npm ca-certificates && rm -rf /var/lib/apt/lists/*

RUN curl -LsSf https://astral.sh/uv/install.sh | sh
ENV PATH="/root/.cargo/bin:${PATH}"

RUN curl -L https://github.com/rapiz1/rathole/releases/latest/download/rathole-x86_64-unknown-linux-musl.tar.gz \
    | tar -xz \
    && mv rathole /usr/local/bin/rathole \
    && chmod +x /usr/local/bin/rathole

WORKDIR /app
COPY . /app

CMD ["bash"]
