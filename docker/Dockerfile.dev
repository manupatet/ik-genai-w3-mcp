FROM python:3.12-slim

ENV DEBIAN_FRONTEND=noninteractive \
    PYTHONDONTWRITEBYTECODE=1 \
    PYTHONUNBUFFERED=1

RUN apt-get update && apt-get install -y --no-install-recommends curl git procps unzip npm wget ca-certificates && rm -rf /var/lib/apt/lists/*

RUN curl -LsSf https://astral.sh/uv/install.sh | sh
ENV PATH="/root/.cargo/bin:${PATH}"

# Install InstaTunnel directly
RUN curl -L https://api.instatunnel.my/releases/instatunnel-linux-amd64 -o /usr/local/bin/instatunnel \
    && chmod +x /usr/local/bin/instatunnel

WORKDIR /app
COPY . /app

CMD ["bash"]
